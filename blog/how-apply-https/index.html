<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="My Site Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="My Site Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="My Site" href="/opensearch.xml"><title data-react-helmet="true">å…è´¹httpsé€šé…ç¬¦è¯ä¹¦ç”³è¯·ä¸é…ç½® | My Site</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://zeffon.github.io/blog/how-apply-https"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="å…è´¹httpsé€šé…ç¬¦è¯ä¹¦ç”³è¯·ä¸é…ç½® | My Site"><meta data-react-helmet="true" name="description" content="Certbot æ˜¯ EFF åŠ å¯†æ•´ä¸ªäº’è”ç½‘çš„ä¸€éƒ¨åˆ†ã€‚é€šè¿‡ Web è¿›è¡Œå®‰å…¨é€šä¿¡ä¾èµ–äº HTTPSï¼Œè¿™éœ€è¦ä½¿ç”¨æ•°å­—è¯ä¹¦ï¼Œä»¥ä¾¿æµè§ˆå™¨éªŒè¯ Web æœåŠ¡å™¨çš„èº«ä»½ã€‚"><meta data-react-helmet="true" property="og:description" content="Certbot æ˜¯ EFF åŠ å¯†æ•´ä¸ªäº’è”ç½‘çš„ä¸€éƒ¨åˆ†ã€‚é€šè¿‡ Web è¿›è¡Œå®‰å…¨é€šä¿¡ä¾èµ–äº HTTPSï¼Œè¿™éœ€è¦ä½¿ç”¨æ•°å­—è¯ä¹¦ï¼Œä»¥ä¾¿æµè§ˆå™¨éªŒè¯ Web æœåŠ¡å™¨çš„èº«ä»½ã€‚"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2019-09-09T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://github.com/zeffon"><meta data-react-helmet="true" property="article:tag" content="linux,https"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://zeffon.github.io/blog/how-apply-https"><link data-react-helmet="true" rel="alternate" href="https://zeffon.github.io/blog/how-apply-https" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://zeffon.github.io/blog/how-apply-https" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://YOUR_APP_ID-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.c95fcd8c.css">
<link rel="preload" href="/assets/js/runtime~main.89f3db80.js" as="script">
<link rel="preload" href="/assets/js/main.410e0645.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">é¦–é¡µ</b></a><a class="navbar__item navbar__link" href="/docs/intro">æ–‡æ¡£</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">åšå®¢</a></div><div class="navbar__items navbar__items--right"><a href="https://www.yuque.com/zeffon/blog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>è¯­é›€<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/zeffon" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ğŸŒ</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">Recent posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/vite">Vite çš„ä»‹ç»</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/get-param-array">GETè¯·æ±‚å¦‚ä½•ä¼ é€’æ•°ç»„å‚æ•°</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/text-show">æ–‡æœ¬æ§åˆ¶æ˜¾ç¤ºæ–¹å¼</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/js-array">JS æ•°ç»„çš„æ€»ç»“</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/js-object">JS å¯¹è±¡çš„æ“ä½œ</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_GeHD" itemprop="headline">å…è´¹httpsé€šé…ç¬¦è¯ä¹¦ç”³è¯·ä¸é…ç½®</h1><div class="blogPostData_291c margin-vert--md"><time datetime="2019-09-09T00:00:00.000Z" itemprop="datePublished">September 9, 2019</time> Â· 4 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_1R69"><div class="avatar margin-bottom--sm"><a href="https://github.com/zeffon" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_1yU8" src="https://github.com/zeffon.png" alt="Zeffon Wu"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/zeffon" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Zeffon Wu</span></a></div><small class="avatar__subtitle" itemprop="description">A web engineer</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>Certbot æ˜¯ EFF åŠ å¯†æ•´ä¸ªäº’è”ç½‘çš„ä¸€éƒ¨åˆ†ã€‚é€šè¿‡ Web è¿›è¡Œå®‰å…¨é€šä¿¡ä¾èµ–äº HTTPSï¼Œè¿™éœ€è¦ä½¿ç”¨æ•°å­—è¯ä¹¦ï¼Œä»¥ä¾¿æµè§ˆå™¨éªŒè¯ Web æœåŠ¡å™¨çš„èº«ä»½ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="å‰è¨€"></a>å‰è¨€<a class="hash-link" href="#å‰è¨€" title="Direct link to heading">#</a></h2><p>Certbot æ˜¯ EFF åŠ å¯†æ•´ä¸ªäº’è”ç½‘çš„ä¸€éƒ¨åˆ†ã€‚é€šè¿‡ Web è¿›è¡Œå®‰å…¨é€šä¿¡ä¾èµ–äº HTTPSï¼Œè¿™éœ€è¦ä½¿ç”¨æ•°å­—è¯ä¹¦ï¼Œä»¥ä¾¿æµè§ˆå™¨éªŒè¯ Web æœåŠ¡å™¨çš„èº«ä»½ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="lets-encrypt-ç®€ä»‹"></a>Let&#x27;s Encrypt ç®€ä»‹<a class="hash-link" href="#lets-encrypt-ç®€ä»‹" title="Direct link to heading">#</a></h3><p>éšç€é˜¿é‡Œå…è´¹çš„ HTTPS è¿‡æœŸåï¼Œä¸å¾—ä¸ä½¿ç”¨å…è´¹ä½¿ç”¨ HTTPSã€‚æ‰€ä»¥å°±éœ€è¦ä»è¯ä¹¦æˆæƒæœºæ„(ä»¥ä¸‹ç®€ç§° CA) å¤„è·å–ä¸€ä¸ªè¯ä¹¦ï¼ŒLet&#x27;s Encrypt å°±æ˜¯ä¸€ä¸ª CAã€‚æˆ‘ä»¬å¯ä»¥ä» Let&#x27;s Encrypt è·å¾—ç½‘ç«™åŸŸåçš„å…è´¹çš„è¯ä¹¦ã€‚è¿™ç¯‡æ–‡ç« ä¹Ÿä¸»è¦è®²çš„æ˜¯é€šè¿‡ Let&#x27;s Encrypt + Nginx æ¥è®©ç½‘ç«™å‡çº§åˆ° HTTPSã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="certbot-ç®€ä»‹"></a>Certbot ç®€ä»‹<a class="hash-link" href="#certbot-ç®€ä»‹" title="Direct link to heading">#</a></h3><p>Certbot æ˜¯ Let&#x27;s Encrypt å®˜æ–¹æ¨èçš„è·å–è¯ä¹¦çš„å®¢æˆ·ç«¯ï¼Œå¯ä»¥å¸®æˆ‘ä»¬è·å–å…è´¹çš„ Let&#x27;s Encrypt è¯ä¹¦ã€‚Certbot æ˜¯ EFF åŠ å¯†æ•´ä¸ªäº’è”ç½‘çš„ä¸€éƒ¨åˆ†ã€‚é€šè¿‡ Web è¿›è¡Œå®‰å…¨é€šä¿¡ä¾èµ–äº HTTPSï¼Œè¿™éœ€è¦ä½¿ç”¨æ•°å­—è¯ä¹¦ï¼Œä»¥ä¾¿æµè§ˆå™¨éªŒè¯ Web æœåŠ¡å™¨çš„èº«ä»½ã€‚Certbot æ˜¯æ”¯æŒæ‰€æœ‰ Unix å†…æ ¸çš„æ“ä½œç³»ç»Ÿçš„ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="ç”³è¯·ä¸é…ç½®"></a>ç”³è¯·ä¸é…ç½®<a class="hash-link" href="#ç”³è¯·ä¸é…ç½®" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="certbot-å®‰è£…"></a>Certbot å®‰è£…<a class="hash-link" href="#certbot-å®‰è£…" title="Direct link to heading">#</a></h3><ol><li>ä½¿ç”¨ <code>Git</code> ä¸‹è½½ <code>certbot</code></li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ git clone https://github.com/certbot/certbot</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ cd certbot</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol><li><code>certbot-auto</code> æˆ–è€… <code>letsencrypt-auto</code>æŸ¥çœ‹å‘½ä»¤å‚æ•°</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./certbot-auto --help</span></span><span class="token-line" style="color:#393A34"><span class="token plain">æˆ–è€…</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ./letsencrypt-auto --help</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly s"><pre tabindex="0" class="prism-code language-s codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">obtain, install, and renew certificates:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">(default) run   Obtain &amp; install a certificate in your current webserver</span></span><span class="token-line" style="color:#393A34"><span class="token plain">certonly        Obtain or renew a certificate, but do not install it</span></span><span class="token-line" style="color:#393A34"><span class="token plain">renew           Renew all previously obtained certificates that are near</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">expiry</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  enhance         Add security enhancements to your existing configuration</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  -d DOMAINS       Comma-separated list of domains to obtain a certificate for</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  --apache          Use the Apache plugin for authentication &amp; installation</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  --standalone      Run a standalone webserver for authentication</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  --nginx           Use the Nginx plugin for authentication &amp; installation</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  --webroot         Place files in a server&#x27;s webroot folder for authentication</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  --manual          Obtain certificates interactively, or using shell script</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>è¿™é‡Œåªå¯¹å‡ ä¸ªé‡è¦çš„å‘½ä»¤å‚æ•°è¿›è¡Œè¯´æ˜</p><ul><li>runï¼šè·å–å¹¶å®‰è£…è¯ä¹¦åˆ°å½“å‰çš„ Web æœåŠ¡å™¨</li><li>certonlyï¼šè·å–æˆ–ç»­æœŸè¯ä¹¦ï¼Œä½†æ˜¯ä¸å®‰è£…</li><li>renewï¼šåœ¨è¯ä¹¦å¿«è¿‡æœŸæ—¶ï¼Œç»­æœŸä¹‹å‰è·å–çš„æ‰€æœ‰è¯ä¹¦</li><li>-d DOMAINSï¼šä¸€ä¸ªè¯ä¹¦æ”¯æŒå¤šä¸ªåŸŸåï¼Œç”¨é€—å·åˆ†éš”</li><li>--apacheï¼šä½¿ç”¨ Apache æ’ä»¶æ¥è®¤è¯å’Œå®‰è£…è¯ä¹¦</li><li>--standaloneï¼šè¿è¡Œç‹¬ç«‹çš„ web server æ¥éªŒè¯</li><li>--nginxï¼šä½¿ç”¨ Nginx æ’ä»¶æ¥è®¤è¯å’Œå®‰è£…è¯ä¹¦</li><li>--webrootï¼šå¦‚æœç›®æ ‡æœåŠ¡å™¨å·²ç»æœ‰ web server è¿è¡Œä¸”ä¸èƒ½å…³é—­ï¼Œå¯ä»¥é€šè¿‡å¾€æœåŠ¡å™¨çš„ç½‘ç«™æ ¹ç›®å½•æ”¾ç½®æ–‡ä»¶çš„æ–¹å¼æ¥éªŒè¯</li><li>--manualï¼šé€šè¿‡äº¤äº’å¼æ–¹å¼ï¼Œæˆ– Shell è„šæœ¬æ‰‹åŠ¨è·å–è¯ä¹¦</li></ul><blockquote><p>å…³äºåŸŸåéªŒè¯å’Œè¯ä¹¦çš„è·å–å®‰è£…ï¼Œä¸Šé¢æåˆ°äº†<code>5ç§</code>æ–¹å¼ï¼š--apache, --standalone, --nginx, --webroot å’Œ --manualï¼Œè¯·æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©å…¶ä¸€ã€‚è¿™é‡Œä¼šè®²å¸¸ç”¨ Nginx å®‰è£…æ–¹å¼ã€‚</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="è·å–è¯ä¹¦"></a>è·å–è¯ä¹¦<a class="hash-link" href="#è·å–è¯ä¹¦" title="Direct link to heading">#</a></h3><ol><li>ä½¿ç”¨ <code>certbot-auto</code> æ¥è·å–è¯ä¹¦ä½†ä¸å®‰è£…</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ ./certbot-auto --email zeffonwu@gmail.com -d &quot;*.thxycn.xin&quot; -d &quot;thxycn.xin&quot; --manual --preferred-challenges dns-01 certonly --server https://acme-v02.api.letsencrypt.org/directory</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>æ³¨æ„å°†ä¸Šé¢çš„é‚®ç®±å’ŒåŸŸåæ›¿æ¢æˆè‡ªå·±çš„ã€‚éœ€è¦ä¸¤ä¸ª-dï¼šç¬¬ä¸€æ˜¯é€šé…ç¬¦åŸŸåé…ç½®ï¼Œç¬¬äºŒä¸ªæ˜¯ä¸»åŸŸåé…ç½®</p><blockquote><p><strong><code>æ³¨æ„</code></strong></p><ol><li>æ‰§è¡Œæ­¤å‘½ä»¤å¿…é¡»ä½¿ç”¨ root ç”¨æˆ·è·å¾—æ–‡ä»¶å¤¹çš„æƒé™</li><li>åŸŸåèƒ½è®¿é—®å¹¶ä¸”æœ‰ç»‘å®šçš„å…¬ç½‘ IP</li><li>å¿…é¡»åœ¨æ­¤åŸŸåç»‘å®šçš„æœåŠ¡å™¨ä¸Šè¿è¡Œ</li><li>ä¼šä½¿ç”¨ 80 æ–­ç«¯å£ï¼Œå¦‚æœ nginx ç›‘å¬ 80 ç«¯å£ï¼ŒæŠŠ nginx å…ˆå…³æ‰</li></ol></blockquote><ol start="2"><li>éœ€è¦åœ¨åŸŸåä¸Šæ–°æ·»åŠ ä¸€æ¡è§£æè®°å½•(ç”±äºè®¾ç½®ä¸¤ä¸ªåŸŸåï¼Œè¿™é‡Œè§£æè®°å½•å€¼ä¹Ÿè¦å¼„ä¸¤æ¬¡)
(<code>ä¸»æœº</code>ï¼š_acme-challenge <code>ç±»å‹</code>ï¼šTXT <code>è®°å½•å€¼</code>ï¼šL435P35DFHIBAOF34548QoqJHbD162748HUDF)</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Please deploy a DNS TXT record under the name</span></span><span class="token-line" style="color:#393A34"><span class="token plain">_acme-challenge.thxycn.xin with the following value:</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">L435P35DFHIBAOF34548QoqJHbD162748HUDF</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Before continuing, verify the record is deployed.</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><blockquote><p><strong><code>æ³¨æ„</code>:</strong> ç”³è¯·é€šé…ç¬¦è¯ä¹¦æ˜¯è¦ç»è¿‡ DNS è®¤è¯çš„ï¼ŒæŒ‰ç…§æç¤ºï¼Œå‰å¾€åŸŸååå°æ·»åŠ å¯¹åº”çš„ DNS TXT è®°å½•ã€‚æ·»åŠ ä¹‹åï¼Œä¸è¦å¿ƒæ€¥ç€æŒ‰å›è½¦ï¼Œå…ˆæ‰§è¡Œ dig xxxx.xxx.com txt ç¡®è®¤è§£æè®°å½•æ˜¯å¦ç”Ÿæ•ˆï¼Œç”Ÿæ•ˆä¹‹åå†å›å»æŒ‰å›è½¦ç¡®è®¤</p></blockquote><p>dig å‘½ä»¤å®‰è£…ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ yum install bind-utils</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ dig _acme-challenge.thxycn.xin</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ä¸‹æ–‡å‡ºç°TXTçš„å€¼åˆ™å¯ä»¥</span></span><span class="token-line" style="color:#393A34"><span class="token plain">;; ANSWER SECTION:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">_acme-challenge.thxycn.xin. 600 IN      TXT     &quot;Refivf35ferdfaypw7ZvfnmkbHDSD8433IGA&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="3"><li>è·å–è¯ä¹¦å‡ºç°å¦‚ä¸‹çš„ <code>NOTES</code>,è¯´æ˜è¯ä¹¦åˆ›å»ºæˆåŠŸäº†</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">IMPORTANT NOTES:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">- Congratulations! Your certificate and chain have been saved at:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  /etc/letsencrypt/live/thxycn.xin/fullchain.pem</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  Your key file has been saved at:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  /etc/letsencrypt/live/thxycn.xin/privkey.pem</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  Your cert will expire on 2019-11-30. To obtain a new or tweaked</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  version of this certificate in the future, simply run</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  letsencrypt-auto again. To non-interactively renew *all* of your</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  certificates, run &quot;letsencrypt-auto renew&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="4"><li>æŸ¥çœ‹è¯ä¹¦(è¯ä¹¦é»˜è®¤ä¿å­˜åœ¨<code>/etc/letsencrypt/live/thxycn.xin</code>)</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">README  cert.pem  chain.pem  fullchain.pem  privkey.pem</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>è€Œ Nginx é…ç½®è¯ä¹¦æˆ‘ä»¬éœ€è¦ç”¨åˆ°çš„è¯ä¹¦æ˜¯ <code>fullchain.pem</code> å’Œ <code>privkey.pem</code>ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="nginx-è¯ä¹¦é…ç½®"></a>Nginx è¯ä¹¦é…ç½®<a class="hash-link" href="#nginx-è¯ä¹¦é…ç½®" title="Direct link to heading">#</a></h3><ol><li>é…ç½® conf æ–‡ä»¶ï¼ˆ<code>æ³¨æ„</code>æ›´æ¢è‡ªå·±çš„è¯ä¹¦ï¼‰</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">server {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen 443;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name thxycn.xin;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl on;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_certificate /etc/letsencrypt/live/thxycn.xin/fullchain.pem; # æ›¿æ¢è‡ªå·±çš„è¯ä¹¦</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_certificate_key /etc/letsencrypt/live/thxycn.xin/privkey.pem; # æ›¿æ¢è‡ªå·±çš„è¯ä¹¦</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_session_cache shared:SSL:1m;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_session_timeout 5m;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_prefer_server_ciphers on;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    location / {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        root   /usr/share/nginx/html;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        index  index.html index.htm;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    error_page   500 502 503 504  /50x.html;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    location = /50x.html {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        root   /usr/share/nginx/html;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">server {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen 80;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name thxycn.xin;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    rewrite ^/(.*) https://$server_name$request_uri? permanent;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="2"><li>éªŒè¯æ˜¯å¦é…ç½®æˆåŠŸ
ä½¿ç”¨ <code>https://thxycn.xin/index.html</code> èƒ½è®¿é—®åˆ° Nginx çš„æ¬¢è¿é¡µé¢ï¼Œåˆ™é…ç½®æˆåŠŸã€‚</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="è‡ªåŠ¨æ›´æ–°-ssl-è¯ä¹¦"></a>è‡ªåŠ¨æ›´æ–° SSL è¯ä¹¦<a class="hash-link" href="#è‡ªåŠ¨æ›´æ–°-ssl-è¯ä¹¦" title="Direct link to heading">#</a></h3><p>Let&#x27;s Encrypt æä¾›çš„è¯ä¹¦åªæœ‰ 90 å¤©çš„æœ‰æ•ˆæœŸï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å†™ä¸€ä¸ªè„šæœ¬åœ¨è¿‡æœŸå‰å®šæ—¶é‡æ–°è·å–è¯ä¹¦ã€‚å¹¶ä¸”è¯ä¹¦è·å–æ˜¯è¦é¢‘æ¬¡é™åˆ¶çš„--æ¯ 7 å¤© 5 æ¬¡ã€‚(limit ~5 per 7 days)ã€‚</p><ol><li>ä½¿ç”¨ <code>certbot renew</code> è‡ªåŠ¨æ›´æ–°è¯ä¹¦</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ certbot-auto renew --manual # éœ€è¦è¿›å…¥/usr/local/certbotç›®å½•</span></span><span class="token-line" style="color:#393A34"><span class="token plain">æˆ–è€…å¯ä»¥ä½¿ç”¨å¼ºåˆ¶æ›´æ–°</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ certbot-auto --force-renew</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><blockquote><p>ä½†æ˜¯å´æŠ¥é”™äº†ã€‚åŸå› : é‡æ–°æ›´æ–°è¯ä¹¦éœ€è¦å¯åŠ¨ 443 ç«¯å£ï¼Œè€Œè¿™ä¸ªç«¯å£è¢« nginx å ç”¨ç€
è§£å†³æ–¹æ³•: å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨æ‰§è¡Œ<code>certbot renew --dry-run</code>å‘½ä»¤å‰ï¼ŒæŠŠ Nginx åœæ­¢ <code>systemctl stop nginx</code>, æ‰§è¡ŒæˆåŠŸåå°±æŠŠ Nginx å¯åŠ¨ <code>systemctl start nginx</code>ã€‚æ‰€ä»¥éœ€è¦ç”¨åˆ° <code>--pre-hook</code>ï¼ˆè¿™ä¸ªå‚æ•°è¡¨ç¤ºæ‰§è¡Œæ›´æ–°æ“ä½œä¹‹å‰è¦åšçš„äº‹æƒ…ï¼‰,<code>--post-hook</code>(è¿™ä¸ªå‚æ•°è¡¨ç¤ºæ‰§è¡Œæ›´æ–°æ“ä½œå®Œæˆåè¦åšçš„äº‹æƒ…)</p></blockquote><ol><li>å®šæ—¶è®¾ç½®(æ¯ 1 ä¸ªæœˆï¼Œå‡Œæ™¨ 10 åˆ†æ‰§è¡Œ)
æ–°å»º certbot-auto-renew-crontab.sh æ–‡ä»¶</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ mkdir crontab # ä¸usråŒçº§ä¸‹æ–°å»ºcrontabç›®å½•</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ vi certbot-auto-renew-crontab.sh</span></span><span class="token-line" style="color:#393A34"><span class="token plain">10 0 * 1 * /usr/local/certbot/certbot-auto --force-renew --pre-hook &quot;systemctl stop nginx&quot; --post-hook &quot;systemctl start nginx&quot; # --force-renew å¼ºåˆ¶æ›´æ–°</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="2"><li>ç”¨ <code>crontab</code> æ¥å¯åŠ¨è¿™ä¸ªå®šæ—¶ä»»åŠ¡</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ crontab certbot-auto-renew-crontab.sh</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_3kfx"><div class="col"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/blog/tags/linux">linux</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/blog/tags/https">https</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/zeffon/zeffon.github.io/blob/master/blog/2019/2019-09-09-how-apply-https.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/linux-install-docker"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« Linuxæ­å»ºDockerç¯å¢ƒ</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/avl-and-redâ€“black-tree"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">AVLæ ‘ã€çº¢é»‘æ ‘å’Œå“ˆå¸Œè¡¨ Â»</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#å‰è¨€" class="table-of-contents__link">å‰è¨€</a><ul><li><a href="#lets-encrypt-ç®€ä»‹" class="table-of-contents__link">Let&#39;s Encrypt ç®€ä»‹</a></li><li><a href="#certbot-ç®€ä»‹" class="table-of-contents__link">Certbot ç®€ä»‹</a></li></ul></li><li><a href="#ç”³è¯·ä¸é…ç½®" class="table-of-contents__link">ç”³è¯·ä¸é…ç½®</a><ul><li><a href="#certbot-å®‰è£…" class="table-of-contents__link">Certbot å®‰è£…</a></li><li><a href="#è·å–è¯ä¹¦" class="table-of-contents__link">è·å–è¯ä¹¦</a></li><li><a href="#nginx-è¯ä¹¦é…ç½®" class="table-of-contents__link">Nginx è¯ä¹¦é…ç½®</a></li><li><a href="#è‡ªåŠ¨æ›´æ–°-ssl-è¯ä¹¦" class="table-of-contents__link">è‡ªåŠ¨æ›´æ–° SSL è¯ä¹¦</a></li></ul></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">æ–‡æ¡£</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="mailto:ZeffonWu@gmail.com" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>ZeffonWu@gmail.com<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://www.yuque.com/zeffon/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>è¯­é›€<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Zeffon, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.89f3db80.js"></script>
<script src="/assets/js/main.410e0645.js"></script>
</body>
</html>